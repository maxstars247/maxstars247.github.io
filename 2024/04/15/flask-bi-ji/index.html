<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Flask笔记, 次元客栈">
    <meta name="description" content="Flask笔记简介：这是知了传音的Flaskb站公开课笔记
Flask项目：https://github.com/pallets/flask
教程：https://www.bilibili.com/video/BV17r4y1y7jJ
背景">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="google-site-verification" content="uCs0vGZTs7OHwPQaDOhOOogilUILupgga56L79DNWDs" />
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Flask笔记 | 次元客栈</title>
    <link rel="icon" type="image/png" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/css/matery.css">
<link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/css/my.css">
<link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/css/reward.css">
    



    <script src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.1.1"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">次元客栈</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">次元客栈</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/images/flask.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Flask笔记</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%95%99%E7%A8%8B/">
                                <span class="chip bg-color">教程</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/python%E6%95%99%E7%A8%8B/" class="post-category">
                                python教程
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-04-15
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2024-04-25
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    5.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    24 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="Flask笔记"><a href="#Flask笔记" class="headerlink" title="Flask笔记"></a>Flask笔记</h2><p><strong>简介</strong>：这是知了传音的Flaskb站公开课笔记</p>
<p><strong>Flask项目</strong>：<a target="_blank" rel="noopener" href="https://github.com/pallets/flask">https://github.com/pallets/flask</a></p>
<p><strong>教程</strong>：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV17r4y1y7jJ">https://www.bilibili.com/video/BV17r4y1y7jJ</a></p>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p><strong>简介</strong>：<code>Flask</code>是一个基于<code>Python</code>的<code>web</code>开发框架，它以灵活、“微”框架著称。<code>Flask</code>的出现也是一个偶然机会，在2010年4月1日愚人节这天，作者<code>Armin Ronacher</code>开了个玩笑，在网上发表了一篇关于“下一代 Python微框架”的文章，众开发者信以为真，并期待他能真正把文章中的想法实现出来。在5天后，<code>Armin Ronacher</code>真的发布了一个“微”框架，他就是<code>Flask</code>。</p>
<p><code>Flask</code>虽然是作者在愚人节开的一个玩笑，但是框架设计却非常优秀，并且深受开发者喜爱，截止 2021年6月，在<code>Github</code>上的<code>Star</code>数已经超过56k，仅次于2005年就发布的<code>Django</code>的<code>58k stars</code>数，相信在不久的将来，<code>Flask</code>的<code>Star</code>数一定会赶超<code>Django</code>!</p>
<p><code>Flask</code>以“微”框架著称，本身不具备太多的功能，但是通过丰富的第三方插件，可以轻松应对现实开发中复杂的需求，并且有大量的企业在使用<code>Flask</code>构建自己的产品。国内比较出名的有比如豆瓣、果壳网，国外的有<code>Reddit</code>、<code>Netflix</code>等，其稳定性和应对复杂业务需求的能力已经被大量企业所验证。因此读者无需担心<code>Flask</code>无法适应企业需求，放心大胆的去学好Flask，能够让你的工作如虎添翼！</p>
<h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p><strong>简介</strong>：使用pycharm开发，使用python3.9+的环境即可，flask使用2.0以上的版本。这里使用anaconda搭建：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 新建conda环境</span>
conda create <span class="token parameter variable">-n</span> flask <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3.9</span> <span class="token parameter variable">-y</span>

<span class="token comment"># 安装flask</span>
conda activate flask
pip <span class="token function">install</span> flask</code></pre>

<h3 id="flask基本配置"><a href="#flask基本配置" class="headerlink" title="flask基本配置"></a>flask基本配置</h3><p><strong>注意</strong>：使用pycharm创建项目时，只建议用专业版进行学习，社区版的配置方案太少，配置环境解决方案少，出了问题很难解决。</p>
<h4 id="新建flask项目"><a href="#新建flask项目" class="headerlink" title="新建flask项目"></a>新建flask项目</h4><p>在pycharm中选择flask项目创建即可</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240313191306253.png"></p>
<p>项目构建好后，基本代码的介绍：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 导包</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask

<span class="token comment"># 使用Flask类创建一个app对象</span>
<span class="token comment"># __name__:代表当前app.py这个模块</span>
<span class="token comment"># 1.对以后出现的bug，可以帮助我们快速定位</span>
<span class="token comment"># 2.对于寻找模板文件，有一个相对路径</span>
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>


<span class="token comment"># 创建一个路由和视图函数的映射</span>
<span class="token comment"># 访问百度时，https://www.baidu,com，就会访问根路径</span>
<span class="token comment"># 在网站开发中叫根路由</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'Hello World!'</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<h4 id="设置debug模式"><a href="#设置debug模式" class="headerlink" title="设置debug模式"></a>设置debug模式</h4><p><strong>简介</strong>：使用编辑配置编辑，选择debug模式即可。</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240313191742301.png"></p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240313191514552.png"></p>
<p><strong>作用</strong>：</p>
<ol>
<li>可以无需重启服务器，使用<code>ctrl+s</code>即可完成修改。</li>
<li>开发的时候出现bug，可以在浏览器看到输出信息</li>
</ol>
<h4 id="修改host-端口"><a href="#修改host-端口" class="headerlink" title="修改host&amp;端口"></a>修改host&amp;端口</h4><p><img src="/2024/04/15/flask-bi-ji/image-20240313195739821.png"></p>
<p><strong>修改host</strong>：可以修改为0.0.0.0即可让局域网电脑访问服务器</p>
<p><strong>修改port</strong>：可以让flask跑在其他端口，防止端口冲突</p>
<h3 id="url与视图映射"><a href="#url与视图映射" class="headerlink" title="url与视图映射"></a>url与视图映射</h3><p><strong>简介</strong>：url后的<code>path</code>是通过<code>route</code>组件控制的，<code>path</code>是指域名后的路径，例如：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 导包</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request

<span class="token comment"># 使用Flask类创建一个app对象</span>
<span class="token comment"># __name__:代表当前app.py这个模块</span>
<span class="token comment"># 1.对以后出现的bug，可以帮助我们快速定位</span>
<span class="token comment"># 2.对于寻找模板文件，有一个相对路径</span>
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>


<span class="token comment"># 创建一个路由和视图函数的映射</span>
<span class="token comment"># 访问百度时，https://www.baidu,com，就会访问根路径</span>
<span class="token comment"># 在网站开发中叫根路由</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'Hello World!'</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/profile'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'我是个人中心'</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/blog/list'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">blog_list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">"我是博客列表"</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/blog/&lt;blog_id>'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">blog_detail</span><span class="token punctuation">(</span>blog_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">"您访问的博客是：%s"</span> <span class="token operator">%</span> blog_id

<span class="token comment"># 查询字符串的方式传参</span>
<span class="token comment"># 定义一个get请求</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/book/list'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">book_list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># arguments:参数</span>
    <span class="token comment"># request.args:类字典类型</span>
    page <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"page"</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"您获取的是第</span><span class="token interpolation"><span class="token punctuation">&#123;</span>page<span class="token punctuation">&#125;</span></span><span class="token string">的图书列表!"</span></span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>

<p>get定义下列数据即可跳转相应页面：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240315133103461.png"></p>
<h3 id="jinja2模板"><a href="#jinja2模板" class="headerlink" title="jinja2模板"></a>jinja2模板</h3><p><strong>简介</strong>：jinja2库主要负责渲染html，利用后端渲染前端的静态页面</p>
<h4 id="html传参"><a href="#html传参" class="headerlink" title="html传参"></a>html传参</h4><p><strong>简介</strong>：使用jinja2将参数传递到html页面中</p>
<p><strong>方法</strong>：在html使用<code>&#123;&#123; &#125;&#125;</code>对需要传递的地方进行标注</p>
<p><strong>html代码</strong>：</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>博客详情<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>您访问的博客详情是：&#123;&#123; blog_id &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>

<p><strong>python代码</strong>：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/blog/&lt;blog_id>'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">blog_details</span><span class="token punctuation">(</span>blog_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'blog_detail.html'</span><span class="token punctuation">,</span> blog_id<span class="token operator">=</span>blog_id<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>

<p>这里直接把<code>get</code>获得的<code>blog_id</code>返回到前端页面</p>
<h5 id="传类和字典"><a href="#传类和字典" class="headerlink" title="传类和字典"></a>传类和字典</h5><p><strong>简介</strong>：定义一个用户信息并返回前端</p>
<p><strong>html代码</strong>：这里统一使用<code>xxx.xxx</code>返回信息</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>&#123;&#123; user.username &#125;&#125; / &#123;&#123; user.password &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>&#123;&#123; person.username &#125;&#125; / &#123;&#123; person.email &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>

<p><strong>python代码</strong>：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 使用类定义用户信息</span>
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>username <span class="token operator">=</span> username
        self<span class="token punctuation">.</span>password <span class="token operator">=</span> password
<span class="token comment"># 使用字典定义用户信息</span>
person<span class="token operator">=</span><span class="token punctuation">&#123;</span>
    <span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">"张三"</span><span class="token punctuation">,</span>
    <span class="token string">"email"</span><span class="token punctuation">:</span><span class="token string">"zhangsan@qq.com"</span>
<span class="token punctuation">&#125;</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"admin"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"123"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> user<span class="token operator">=</span>user<span class="token punctuation">,</span>person<span class="token operator">=</span>person<span class="token punctuation">)</span>
</code></pre>

<h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h4><p><strong>简介</strong>：可以将参数处理的函数。</p>
<p><strong>html代码</strong>：</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>&#123;&#123; user.username &#125;&#125; / &#123;&#123; user.username|length &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre>

<p><code>jinja2</code>里有很多过滤器，这里使用<code>length</code>过滤器来处理<code>username</code>函数，作用是计算<code>user.username</code>的字符长度</p>
<h5 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h5><p><strong>简介</strong>：如果jinja2的过滤器无法满足需求，可以自定义过滤器，这里定义一个整理时间格式的过滤器</p>
<p><strong>html代码</strong>：这里使用自定义过滤器<code>dformat</code></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span>
<span class="token operator">&lt;</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>title<span class="token operator">></span>过滤器使用<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
<span class="token operator">&lt;</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> user<span class="token punctuation">.</span>username <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> user<span class="token punctuation">.</span>username<span class="token operator">|</span>length <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
<span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> mytime<span class="token operator">|</span>dformat <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre>

<p><strong>python代码</strong>：导入<code>datetime</code>，编写<code>dformat</code>方法，添加至过滤器</p>
<p><strong>改动部分</strong>：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token comment"># 自定义过滤器</span>
<span class="token comment"># 先定义函数方法</span>
<span class="token keyword">def</span> <span class="token function">datetime_format</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> value<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token punctuation">)</span>
<span class="token comment"># 导入函数，并重命名为datetime</span>
app<span class="token punctuation">.</span>add_template_filter<span class="token punctuation">(</span>datetime_format<span class="token punctuation">,</span><span class="token string">"dformat"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/filter'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">filter_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"admin"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"123"</span><span class="token punctuation">)</span>
    mytime <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'filter.html'</span><span class="token punctuation">,</span> user<span class="token operator">=</span>user<span class="token punctuation">,</span>mytime<span class="token operator">=</span>mytime<span class="token punctuation">)</span></code></pre>

<p><strong>完整代码</strong>：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 导包</span>
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token comment"># 使用类定义用户信息</span>
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>username <span class="token operator">=</span> username
        self<span class="token punctuation">.</span>password <span class="token operator">=</span> password
<span class="token comment"># 使用字典定义用户信息</span>
person<span class="token operator">=</span><span class="token punctuation">&#123;</span>
    <span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">"张三"</span><span class="token punctuation">,</span>
    <span class="token string">"email"</span><span class="token punctuation">:</span><span class="token string">"zhangsan@qq.com"</span>
<span class="token punctuation">&#125;</span>

<span class="token comment"># 自定义过滤器</span>
<span class="token comment"># 先定义函数方法</span>
<span class="token keyword">def</span> <span class="token function">datetime_format</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> value<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token builtin">format</span><span class="token punctuation">)</span>
<span class="token comment"># 导入函数，并重命名为datetime</span>
app<span class="token punctuation">.</span>add_template_filter<span class="token punctuation">(</span>datetime_format<span class="token punctuation">,</span><span class="token string">"dformat"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"admin"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"123"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> user<span class="token operator">=</span>user<span class="token punctuation">,</span>person<span class="token operator">=</span>person<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/blog/&lt;blog_id>'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">blog_details</span><span class="token punctuation">(</span>blog_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'blog_detail.html'</span><span class="token punctuation">,</span> blog_id<span class="token operator">=</span>blog_id<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/filter'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">filter_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"admin"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"123"</span><span class="token punctuation">)</span>
    mytime <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'filter.html'</span><span class="token punctuation">,</span> user<span class="token operator">=</span>user<span class="token punctuation">,</span>mytime<span class="token operator">=</span>mytime<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre>

<p><strong>效果</strong>：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240315183911673.png"></p>
<h4 id="if-for控制"><a href="#if-for控制" class="headerlink" title="if,for控制"></a>if,for控制</h4><p><strong>简介</strong>：if，for两个判断语句可以判断参数条件，并对相应的内容渲染</p>
<p>这里编写一个<code>if</code>判断数值样例和<code>for</code>循环渲染</p>
<p><strong>html代码</strong>：</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
&#123;% if int!=9 %&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>不是琪露诺<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
&#123;% else %&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>是⑨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
&#123;% endif %&#125;

&#123;% for role in roles %&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>名称：&#123;&#123; role.name &#125;&#125;，工作：&#123;&#123; role.work &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
&#123;% endfor %&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>

<p><strong>python代码</strong>：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/control'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">control_demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">10</span>
    roles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>
        <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"灵梦"</span><span class="token punctuation">,</span>
        <span class="token string">"work"</span><span class="token punctuation">:</span> <span class="token string">"神社巫女"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>
        <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"魔理沙"</span><span class="token punctuation">,</span>
        <span class="token string">"work"</span><span class="token punctuation">:</span> <span class="token string">"学习魔法"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'control.html'</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> roles<span class="token operator">=</span>roles<span class="token punctuation">)</span>
</code></pre>

<p><strong>效果</strong>：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240315183601612.png"></p>
<h4 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h4><p><strong>简介</strong>：有很多页面有顶部导航条和底部栏，我们不能每个页面都写入这些元素，这时可以使用模板继承来将这些元素继承：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240315193807654.png"></p>
<p><strong>html代码</strong>：由base，child1，child2组成</p>
<p><strong>base</strong>：</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>&#123;% block title %&#125;&#123;% endblock %&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>新闻<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
我是父模板
&#123;% block body %&#125;
&#123;% endblock %&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span>这是底部的标签<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>

<p><strong>child1</strong>：</p>
<pre class="language-markup" data-language="markup"><code class="language-markup">&#123;% extends "base.html" %&#125;

&#123;% block title %&#125;
我是子模版的标题
&#123;% endblock %&#125;


&#123;% block body %&#125;
我是子模板的body
&#123;% endblock %&#125;</code></pre>

<p><strong>chlid2</strong>:</p>
<pre class="language-markup" data-language="markup"><code class="language-markup">&#123;% extends "base.html" %&#125;

&#123;% block title %&#125;
我是child2
&#123;% endblock %&#125;

&#123;% block body %&#125;
我是child2
&#123;% endblock %&#125;</code></pre>

<p><strong>python代码</strong>：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/child1'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">child1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"child1.html"</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/child2'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">child2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"child2.html"</span><span class="token punctuation">)</span>
</code></pre>

<p><strong>效果</strong>：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240315201609484.png"></p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240315201523928.png"></p>
<h4 id="加载静态资源"><a href="#加载静态资源" class="headerlink" title="加载静态资源"></a>加载静态资源</h4><p><strong>简介</strong>：可以通过<code>url_for</code>的方法来引用静态文件。</p>
<h3 id="对接mysql"><a href="#对接mysql" class="headerlink" title="对接mysql"></a>对接mysql</h3><p><strong>简介</strong>：mysql是oricle的一个数据库产品，社区版是开源免费的，这里介绍oricle的对接介绍。</p>
<p><strong>下载</strong>：<a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/installer/">https://dev.mysql.com/downloads/installer/</a></p>
<h4 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h4><p><strong>简介</strong>：原视频的教程使用了<code>developer default</code>选项，但是现在的8.0.36版本没有这个选项，需要观看另外两个教程进行安装</p>
<p><strong>教程</strong>：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/2201_75609002/article/details/136404667">https://blog.csdn.net/2201_75609002/article/details/136404667</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12q4y1477i">https://www.bilibili.com/video/BV12q4y1477i</a></p>
<p>按照上述教程对flask教程安装完成即可</p>
<h4 id="安装连接sql环境"><a href="#安装连接sql环境" class="headerlink" title="安装连接sql环境"></a>安装连接sql环境</h4><p><strong>简介</strong>：连接mysql的驱动有很多，这里使用pymysql进行演示，安装pymysql：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> pymysql</code></pre>

<p>操作数据库需要使用ORM方式，这里使用flask-sqlalchemy</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> flask-sqlalchemy</code></pre>

<h4 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h4><p><strong>简介</strong>：操作数据库可以使用Navicat，在网上找破解版即可，这里涉及版权问题，不过多介绍了</p>
<p><strong>操作</strong>：文件中选择新建MySQL连接</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240316194425181.png"></p>
<p>填写连接名和密码，连接名随便填，填写完成后点击确定：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240316194622454.png"></p>
<p>连接完成后新建数据库，右键连接名，选择新建数据库：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240316194859044.png"></p>
<p>数据库填写下列信息，点击确定完成创建：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240316194807144.png"></p>
<h4 id="编写程序连接mysql"><a href="#编写程序连接mysql" class="headerlink" title="编写程序连接mysql"></a>编写程序连接mysql</h4><p><strong>简介</strong>：创建好环境后，运行下列代码查看是否连接成功，如成功则返回(1,)</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> text

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token comment"># MySQL所在的主机名</span>
HOSTNAME <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
<span class="token comment"># MySQL所在的端口号</span>
PORT <span class="token operator">=</span> <span class="token number">3306</span>
<span class="token comment"># 连接MySQL的用户名</span>
USERNAME <span class="token operator">=</span> <span class="token string">"root"</span>
<span class="token comment"># 连接MySQL的密码</span>
PASSWORD <span class="token operator">=</span> <span class="token string">"root"</span>
<span class="token comment"># MySQL上创建的数据库名称</span>
DATABASE <span class="token operator">=</span> <span class="token string">"database_learn"</span>

app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SQLALCHEMY_DATABASE_URI"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"mysql+pymysql://</span><span class="token interpolation"><span class="token punctuation">&#123;</span>USERNAME<span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>PASSWORD<span class="token punctuation">&#125;</span></span><span class="token string">@</span><span class="token interpolation"><span class="token punctuation">&#123;</span>HOSTNAME<span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>PORT<span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>DATABASE<span class="token punctuation">&#125;</span></span><span class="token string">?charset=utf8mb4"</span></span>

<span class="token comment"># 在app.config中设置好连接数据库的信息</span>
<span class="token comment"># 使用SQLAlchemy(app)创建一个db对象</span>
<span class="token comment"># SQLAlchemy会自动读取app.config中连接数据库的信息</span>
db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span>app<span class="token punctuation">)</span>

<span class="token comment"># 测试是否连接成功代码</span>
<span class="token keyword">with</span> app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> db<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
        rs <span class="token operator">=</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>text<span class="token punctuation">(</span><span class="token string">"select 1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># (1,)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># put application's code here</span>
    <span class="token keyword">return</span> <span class="token string">'Hello World!'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>

<p><strong>运行结果如下</strong>：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240316200453313.png"></p>
<h3 id="创建ORM模型"><a href="#创建ORM模型" class="headerlink" title="创建ORM模型"></a>创建ORM模型</h3><p><strong>简介</strong>：创建ORM模型的目的是为了方便更换数据库，使所有数据库操作都有一致的命令来操作</p>
<p>使用python创建一个orm模型并导入数据库：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> text

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token comment"># MySQL所在的主机名</span>
HOSTNAME <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
<span class="token comment"># MySQL所在的端口号</span>
PORT <span class="token operator">=</span> <span class="token number">3306</span>
<span class="token comment"># 连接MySQL的用户名</span>
USERNAME <span class="token operator">=</span> <span class="token string">"root"</span>
<span class="token comment"># 连接MySQL的密码</span>
PASSWORD <span class="token operator">=</span> <span class="token string">"root"</span>
<span class="token comment"># MySQL上创建的数据库名称</span>
DATABASE <span class="token operator">=</span> <span class="token string">"database_learn"</span>

app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SQLALCHEMY_DATABASE_URI"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"mysql+pymysql://</span><span class="token interpolation"><span class="token punctuation">&#123;</span>USERNAME<span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>PASSWORD<span class="token punctuation">&#125;</span></span><span class="token string">@</span><span class="token interpolation"><span class="token punctuation">&#123;</span>HOSTNAME<span class="token punctuation">&#125;</span></span><span class="token string">:"</span></span>
                                         <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>PORT<span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>DATABASE<span class="token punctuation">&#125;</span></span><span class="token string">?charset=utf8mb4"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 在app.config中设置好连接数据库的信息</span>
<span class="token comment"># 使用SQLAlchemy(app)创建一个db对象</span>
<span class="token comment"># SQLAlchemy会自动读取app.config中连接数据库的信息</span>
db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span>app<span class="token punctuation">)</span>

<span class="token comment"># 测试是否连接成功代码</span>
<span class="token comment"># with app.app_context():</span>
<span class="token comment">#     with db.engine.connect() as conn:</span>
<span class="token comment">#         rs = conn.execute(text("select 1"))</span>
<span class="token comment">#         print(rs.fetchone())    # (1,)</span>

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"user"</span>
    <span class="token comment"># primary_key=True 设置主键 autoincrement=True 设置自动增加</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> autoincrement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment"># db.String指定varchar类型(变动char类型)</span>
    username <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token comment"># user = User(username="张三", password="123456")</span>
<span class="token comment"># 相当于这条语句sql: insert user(username, password) values('张三', '123456')</span>

<span class="token keyword">with</span> app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    db<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># put application's code here</span>
    <span class="token keyword">return</span> <span class="token string">'Hello World!'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>

<p><strong>运行后可以在navicat中查看，右键选择设计表，可以看见我们刚才创建的表结构</strong>：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240317133116024.png"></p>
<p><strong>表结构如下</strong>：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240317133256277.png"></p>
<h4 id="对mysql进行CRUD操作"><a href="#对mysql进行CRUD操作" class="headerlink" title="对mysql进行CRUD操作"></a>对mysql进行CRUD操作</h4><p><strong>简介</strong>：CROD指的是增删改查：create，read，update，delete。这里所有的操作都要先对db.session进行修改，通过db.session同步到数据库</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> text

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token comment"># MySQL所在的主机名</span>
HOSTNAME <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
<span class="token comment"># MySQL所在的端口号</span>
PORT <span class="token operator">=</span> <span class="token number">3306</span>
<span class="token comment"># 连接MySQL的用户名</span>
USERNAME <span class="token operator">=</span> <span class="token string">"root"</span>
<span class="token comment"># 连接MySQL的密码</span>
PASSWORD <span class="token operator">=</span> <span class="token string">"root"</span>
<span class="token comment"># MySQL上创建的数据库名称</span>
DATABASE <span class="token operator">=</span> <span class="token string">"database_learn"</span>

app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SQLALCHEMY_DATABASE_URI"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"mysql+pymysql://</span><span class="token interpolation"><span class="token punctuation">&#123;</span>USERNAME<span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>PASSWORD<span class="token punctuation">&#125;</span></span><span class="token string">@</span><span class="token interpolation"><span class="token punctuation">&#123;</span>HOSTNAME<span class="token punctuation">&#125;</span></span><span class="token string">:"</span></span>
                                         <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>PORT<span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>DATABASE<span class="token punctuation">&#125;</span></span><span class="token string">?charset=utf8mb4"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 在app.config中设置好连接数据库的信息</span>
<span class="token comment"># 使用SQLAlchemy(app)创建一个db对象</span>
<span class="token comment"># SQLAlchemy会自动读取app.config中连接数据库的信息</span>
db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span>app<span class="token punctuation">)</span>

<span class="token comment"># 测试是否连接成功代码</span>
<span class="token comment"># with app.app_context():</span>
<span class="token comment">#     with db.engine.connect() as conn:</span>
<span class="token comment">#         rs = conn.execute(text("select 1"))</span>
<span class="token comment">#         print(rs.fetchone())    # (1,)</span>

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"user"</span>
    <span class="token comment"># primary_key=True 设置主键 autoincrement=True 设置自动增加</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> autoincrement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment"># db.String指定varchar类型(变动char类型)</span>
    username <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token comment"># user = User(username="张三", password="123456")</span>
<span class="token comment"># 相当于这条语句sql: insert user(username, password) values('张三', '123456')</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/user/add"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1.创建ORM对象</span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"张三"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"123456"</span><span class="token punctuation">)</span>
    <span class="token comment"># 2.将ORM对象添加到db.session中</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    <span class="token comment"># 3.将db.session中的改变同步到数据库中</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"用户创建成功"</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/user/query"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">query_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1.get查找:根据主键查找</span>
    <span class="token comment"># user = User.query.get(1)</span>
    <span class="token comment"># print(f"&#123;user.id&#125;: &#123;user.username&#125;-&#123;user.password&#125;")</span>
    <span class="token comment"># 2.filter_by查找</span>
    <span class="token comment"># Query：类数组</span>
    users <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"张三"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> user <span class="token keyword">in</span> users<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>username<span class="token punctuation">,</span> user<span class="token punctuation">.</span>password<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"数据查找成功！"</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/user/update"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">update_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    user<span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token string">"111111"</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"数据修改成功"</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/user/delete"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">delete_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1.查找</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment"># 2.从db.session中的修改，同步到数据库中</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    <span class="token comment"># 3.将db.session中的修改同步到数据库中</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    db<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># put application's code here</span>
    <span class="token keyword">return</span> <span class="token string">'Hello World!'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>

<h4 id="添加主键和外键"><a href="#添加主键和外键" class="headerlink" title="添加主键和外键"></a>添加主键和外键</h4><p><strong>简介</strong>：数据库中的主键是每张表里唯一的，外键则起到关联表的作用，防止无效数据产生。</p>
<p>这里主要创建了一个<code>user</code>表和一个关联<code>user_id</code>的<code>article</code>外键表，<code>user_id</code>为<code>user</code>表的主键，<code>author_id</code>为<code>article</code>表的外键。但是由于外键是写死的，要查看<code>user_id</code>来<code>get</code>。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> text

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token comment"># MySQL所在的主机名</span>
HOSTNAME <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
<span class="token comment"># MySQL所在的端口号</span>
PORT <span class="token operator">=</span> <span class="token number">3306</span>
<span class="token comment"># 连接MySQL的用户名</span>
USERNAME <span class="token operator">=</span> <span class="token string">"root"</span>
<span class="token comment"># 连接MySQL的密码</span>
PASSWORD <span class="token operator">=</span> <span class="token string">"root"</span>
<span class="token comment"># MySQL上创建的数据库名称</span>
DATABASE <span class="token operator">=</span> <span class="token string">"database_learn"</span>

app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SQLALCHEMY_DATABASE_URI"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"mysql+pymysql://</span><span class="token interpolation"><span class="token punctuation">&#123;</span>USERNAME<span class="token punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>PASSWORD<span class="token punctuation">&#125;</span></span><span class="token string">@</span><span class="token interpolation"><span class="token punctuation">&#123;</span>HOSTNAME<span class="token punctuation">&#125;</span></span><span class="token string">:"</span></span>
                                         <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>PORT<span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>DATABASE<span class="token punctuation">&#125;</span></span><span class="token string">?charset=utf8mb4"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 在app.config中设置好连接数据库的信息</span>
<span class="token comment"># 使用SQLAlchemy(app)创建一个db对象</span>
<span class="token comment"># SQLAlchemy会自动读取app.config中连接数据库的信息</span>
db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span>app<span class="token punctuation">)</span>

<span class="token comment"># 测试是否连接成功代码</span>
<span class="token comment"># with app.app_context():</span>
<span class="token comment">#     with db.engine.connect() as conn:</span>
<span class="token comment">#         rs = conn.execute(text("select 1"))</span>
<span class="token comment">#         print(rs.fetchone())    # (1,)</span>

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"user"</span>
    <span class="token comment"># primary_key=True 设置主键 autoincrement=True 设置自动增加</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> autoincrement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment"># db.String指定varchar类型(变动char类型)</span>
    username <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Article</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"article"</span>
    <span class="token comment"># primary_key=True 设置主键 autoincrement=True 设置自动增加</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> autoincrement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    title <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    <span class="token comment"># 这里引用的是text，string最多存255字符，已经不够用了</span>
    content <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Text<span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token comment"># 添加作者id外键</span>
    author_id <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> db<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span><span class="token string">"user.id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># backref:会自动给User模型添加一个articles的属性，用来获取文章列表</span>
    author <span class="token operator">=</span> db<span class="token punctuation">.</span>relationship<span class="token punctuation">(</span><span class="token string">"User"</span><span class="token punctuation">,</span> backref<span class="token operator">=</span>db<span class="token punctuation">.</span>backref<span class="token punctuation">(</span><span class="token string">"articles"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> app<span class="token punctuation">.</span>app_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    db<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># user = User(username="张三", password="123456")</span>
<span class="token comment"># 相当于这条语句sql: insert user(username, password) values('张三', '123456')</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># put application's code here</span>
    <span class="token keyword">return</span> <span class="token string">'Hello World!'</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/user/add"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1.创建ORM对象</span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"张三"</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"123456"</span><span class="token punctuation">)</span>
    <span class="token comment"># 2.将ORM对象添加到db.session中</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    <span class="token comment"># 3.将db.session中的改变同步到数据库中</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"用户创建成功"</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/user/query"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">query_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1.get查找:根据主键查找</span>
    <span class="token comment"># user = User.query.get(1)</span>
    <span class="token comment"># print(f"&#123;user.id&#125;: &#123;user.username&#125;-&#123;user.password&#125;")</span>
    <span class="token comment"># 2.filter_by查找</span>
    <span class="token comment"># Query：类数组</span>
    users <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"张三"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> user <span class="token keyword">in</span> users<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>username<span class="token punctuation">,</span> user<span class="token punctuation">.</span>password<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"数据查找成功！"</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/user/update"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">update_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    user<span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token string">"111111"</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"数据修改成功"</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/user/delete"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">delete_user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1.查找</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment"># 2.从db.session中的修改，同步到数据库中</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    <span class="token comment"># 3.将db.session中的修改同步到数据库中</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"数据删除成功"</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/article/add"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add_article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    article1 <span class="token operator">=</span> Article<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"Flask学习大纲"</span><span class="token punctuation">,</span> content<span class="token operator">=</span><span class="token string">"Flaskxxx"</span><span class="token punctuation">)</span>
    article1<span class="token punctuation">.</span>author <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

    article2 <span class="token operator">=</span> Article<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"Django学习大纲"</span><span class="token punctuation">,</span> content<span class="token operator">=</span><span class="token string">"Django最全学习大纲"</span><span class="token punctuation">)</span>
    article2<span class="token punctuation">.</span>author <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token comment"># 添加到session中</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add_all<span class="token punctuation">(</span><span class="token punctuation">[</span>article1<span class="token punctuation">,</span> article2<span class="token punctuation">]</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"文章添加成功"</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/article/query"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">query_article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> article <span class="token keyword">in</span> user<span class="token punctuation">.</span>articles<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"文章查找成功！"</span>



<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>

<p><strong>注意</strong>：一定要有用户表否则无法产生外键关联</p>
<p><strong>user表</strong>：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240318143306558.png"></p>
<p><strong>关联表</strong>：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240318143237013.png"></p>
<h3 id="迁移ORM模型"><a href="#迁移ORM模型" class="headerlink" title="迁移ORM模型"></a>迁移ORM模型</h3><p><strong>简介</strong>：之前创建数据库的表的指令<code>db.create_all()</code>这种方式有很大的局限性，在创建好表以后，不能在对表结构进行修改。为了能够对表结构进行修改，需要使用<code>migrate</code>库</p>
<p>安装<code>flask-migrate</code>：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> flask-migrate</code></pre>

<p><strong>在连接代码后添加下面的代码</strong>：</p>
<pre class="language-python" data-language="python"><code class="language-python">db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span>app<span class="token punctuation">)</span>
migrate <span class="token operator">=</span> Migrate<span class="token punctuation">(</span>app<span class="token punctuation">,</span> db<span class="token punctuation">)</span></code></pre>

<p><img src="/2024/04/15/flask-bi-ji/image-20240318190341510.png"></p>
<p>添加完成后在终端进行操作：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1.flask db init: 这步只需要执行一次</span>
python <span class="token parameter variable">-m</span> flask db init

<span class="token comment"># 2.flask db migrate: 识别ORM模型的改变，生成迁移脚本</span>
flask db migrate

<span class="token comment"># 3.flask db upgrade: 运行迁移脚本，同步到数据库中</span>
flask db upgrade</code></pre>

<h2 id="搭建问答平台"><a href="#搭建问答平台" class="headerlink" title="搭建问答平台"></a>搭建问答平台</h2><p><strong>简介</strong>：一个基于flask的论坛</p>
<h3 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h3><p><strong>简介</strong>：新建项目，搭建项目架构。上面学的东西只是flask基础，项目架构才是一个项目真正的核心。</p>
<h4 id="项目架构"><a href="#项目架构" class="headerlink" title="项目架构"></a>项目架构</h4><p><strong>简介</strong>：所有配置文件都要和<code>app.py</code>关联。项目文件结果如图所示：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240322155244244.png"></p>
<p><code>app.py</code>：项目的执行文件</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">import</span> config
<span class="token keyword">from</span> exts <span class="token keyword">import</span> db
<span class="token keyword">from</span> models <span class="token keyword">import</span> UserModel
<span class="token keyword">from</span> blueprint<span class="token punctuation">.</span>qa <span class="token keyword">import</span> bp <span class="token keyword">as</span> qa_bp
<span class="token keyword">from</span> blueprint<span class="token punctuation">.</span>author <span class="token keyword">import</span> bp <span class="token keyword">as</span> author_bp
<span class="token keyword">from</span> flask_migrate <span class="token keyword">import</span> Migrate

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
<span class="token comment"># 绑定配置文件</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_object<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
<span class="token comment"># 这种db的创建方法允许先创建再导入模型</span>
db<span class="token punctuation">.</span>init_app<span class="token punctuation">(</span>app<span class="token punctuation">)</span>

migrate <span class="token operator">=</span> Migrate<span class="token punctuation">(</span>app<span class="token punctuation">,</span> db<span class="token punctuation">)</span>
<span class="token comment"># 导入蓝图</span>
app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>qa_bp<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>author_bp<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>

<p><code>config.py</code>：配置文件，主要配置cookie和加密，使用<code>app.config.form_object(config)</code>和<code>app.py</code>绑定</p>
<p><code>models.py</code>：创建ORM模型的文件</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> exts <span class="token keyword">import</span> db

<span class="token keyword">class</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span></code></pre>

<p><code>exts.py</code>：<code>exts</code>主要存放插件方法。例如：</p>
<p><code>ORM</code>模型在开发时不会放在<code>app.py</code>中，而是独立放在一个<code>model.py</code>文件中。但是<code>model.py</code>需要引用<code>app.py</code>中的<code>db</code>方法，<code>app.py</code>又需要引用<code>models.py</code>中的<code>Usermodel</code>，这样会导致循环引用使代码不能执行，如图所示：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240322145431095-17110904740371.png"></p>
<p>为了解决这个问题，需要建立<code>exts.py</code>文件，存放db &#x3D; SQLAlchemy()方法，使得app.py和models.py分别去调用db方法，这样就不会产生循环引用，如图所示：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240322142512659.png"></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># flask-sqlalchemy</span>
<span class="token keyword">from</span> flask_sqlalchemy <span class="token keyword">import</span> SQLAlchemy

db <span class="token operator">=</span> SQLAlchemy<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p><code>blueprints</code>：在项目搭建过程中，我们不会把路由放到app.py中，而是放到blueprint.py中通过蓝图的形式导入。</p>
<p><code>author.py</code>：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Blueprint

<span class="token comment"># 这里指定/author前缀，用这个方法做路由的都有/author的前缀</span>
bp <span class="token operator">=</span> BLUEPRINT <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span><span class="token string">'author'</span><span class="token punctuation">,</span> __name__<span class="token punctuation">,</span> url_prefix<span class="token operator">=</span><span class="token string">'/author'</span><span class="token punctuation">)</span>

<span class="token comment"># 这里的路由路径为：http://localhost/auth/login</span>
<span class="token decorator annotation punctuation">@bp<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login_page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span></code></pre>

<p><code>qa.py</code>：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Blueprint

<span class="token comment"># 这里不指定前缀</span>
bp <span class="token operator">=</span> BLUEPRINT <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span><span class="token string">'auth'</span><span class="token punctuation">,</span> __name__<span class="token punctuation">,</span> url_prefix<span class="token operator">=</span><span class="token string">'/'</span><span class="token punctuation">)</span>

<span class="token comment"># 这里的路由路径为：http://localhost/login</span>
<span class="token decorator annotation punctuation">@bp<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login_page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span></code></pre>

<h4 id="创建数据库-1"><a href="#创建数据库-1" class="headerlink" title="创建数据库"></a>创建数据库</h4><p><strong>简介</strong>：这里需要创建user数据库，并将数据库进行连接。</p>
<p><strong>先创建一个forum数据库</strong>：</p>
<p><img src="/2024/04/15/flask-bi-ji/image-20240322190405892.png"></p>
<p><strong>设置config.py</strong>：</p>
<pre class="language-python" data-language="python"><code class="language-python">
<span class="token comment"># 数据库配置信息</span>
HOSTNAME <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
PORT <span class="token operator">=</span> <span class="token number">3306</span>
USERNAME <span class="token operator">=</span> <span class="token string">"root"</span>
PASSWORD <span class="token operator">=</span> <span class="token string">"root"</span>
DATABASE <span class="token operator">=</span> <span class="token string">"forum_user"</span>
DB_URI <span class="token operator">=</span> <span class="token string">'mysql+pymysql://&#123;&#125;:&#123;&#125;@&#123;&#125;:&#123;&#125;/&#123;&#125;?charset=utf8'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>USERNAME<span class="token punctuation">,</span> PASSWORD<span class="token punctuation">,</span> HOSTNAME<span class="token punctuation">,</span> PORT<span class="token punctuation">,</span> DATABASE<span class="token punctuation">)</span>
SQLALCHEMY_DATABASE_URI <span class="token operator">=</span> DB_URI</code></pre>

<p><strong>设置model.py数据库表</strong>：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> exts <span class="token keyword">import</span> db
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">class</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">"user"</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> autoincrement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    username <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    email <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    join_time <span class="token operator">=</span> db<span class="token punctuation">.</span>Column<span class="token punctuation">(</span>db<span class="token punctuation">.</span>DateTime<span class="token punctuation">,</span> default<span class="token operator">=</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">)</span></code></pre>

<p>设置app.py，添加migrate的引用：</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">import</span> config
<span class="token keyword">from</span> exts <span class="token keyword">import</span> db
<span class="token keyword">from</span> models <span class="token keyword">import</span> UserModel
<span class="token keyword">from</span> blueprint<span class="token punctuation">.</span>qa <span class="token keyword">import</span> bp <span class="token keyword">as</span> qa_bp
<span class="token keyword">from</span> blueprint<span class="token punctuation">.</span>author <span class="token keyword">import</span> bp <span class="token keyword">as</span> author_bp
<span class="token keyword">from</span> flask_migrate <span class="token keyword">import</span> Migrate

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
<span class="token comment"># 绑定配置文件</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_object<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
<span class="token comment"># 这种db的创建方法允许先创建再导入模型</span>
db<span class="token punctuation">.</span>init_app<span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token comment"># 新增内容</span>
migrate <span class="token operator">=</span> Migrate<span class="token punctuation">(</span>app<span class="token punctuation">,</span> db<span class="token punctuation">)</span>
<span class="token comment"># 导入蓝图</span>
app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>qa_bp<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>author_bp<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>

<p><strong>使用命令创建数据库</strong>：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">flask db init
flask db migrate
flask db upgrade</code></pre>


                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">wqa</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://maxstars247.github.io/2024/04/15/flask-bi-ji/">https://maxstars247.github.io/2024/04/15/flask-bi-ji/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">wqa</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%95%99%E7%A8%8B/">
                                    <span class="chip bg-color">教程</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2024/04/15/flask-bi-ji/">
                    <div class="card-image">
                        
                        <img src="/medias/images/flask.png" class="responsive-img" alt="Flask笔记">
                        
                        <span class="card-title">Flask笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-04-15
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/python%E6%95%99%E7%A8%8B/" class="post-category">
                                    python教程
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%95%99%E7%A8%8B/">
                        <span class="chip bg-color">教程</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/02/21/deng-ji-pai-zhong-de-xin-xi/">
                    <div class="card-image">
                        
                        <img src="/medias/images/flightaware.png" class="responsive-img" alt="登机牌中的信息">
                        
                        <span class="card-title">登机牌中的信息</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-02-21
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%A4%BE%E5%B7%A5/" class="post-category">
                                    社工
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%95%99%E7%A8%8B/">
                        <span class="chip bg-color">教程</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2024</span>
            
            <a href="/about" target="_blank">wqa</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/maxstars247" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1101447047@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>



    <script src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/aos/aos.js"></script>
    <script src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="https://fastly.jsdelivr.net/gh/maxstars247/maxstars247.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
